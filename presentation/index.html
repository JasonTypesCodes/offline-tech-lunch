<html>
  <head>
    <meta charset="utf-8">
    <title>Offline Web Applications</title>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>Offline Web Applications</h1>
          <h3 class="lots-of-space">OCI Tech Lunch 06/30/2017</h3>
          <h3>Jason Schindler</h3>
        </section>
        <section>
          <h2 class="hard-left">Offline Web Application</h2>
          <p class="lots-of-space hard-left">A <b>Progressive Web Application</b> that has been designed to perform at <b>some capacity</b> while <b>offline</b></p>
        </section>
        <section>
          <h2 class="hard-left">Offline Web Application</h2>
          <p class="bits-of-space hard-left">At <b>some capacity</b>:</p>
          <ul class="hard-left">
            <li class="fragment">Communication with user about connection state</li>
            <li class="fragment">Caching server operations for later</li>
            <li class="fragment">Adding/removing features while running</li>
            <li class="fragment">Server? We don't need no stinkin' server!</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Why Offline Apps?</h2>
          <p class="bits-of-space hard-left">Many web applications do not run in traditional browsers</p>
          <ul class="hard-left">
            <li>Mobile Apps in Cordova</li>
            <li>Desktop Apps in Electron</li>
          </ul>
          <p class="bits-of-space hard-left">Networks aren't necessarily reliable</p>
          <ul class="hard-left">
            <li>Mobile networks</li>
            <li>Areas with poor/sparse infrastructure</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">&#8220;Offline&dash;First&#8221; Development</h2>
          <p class="bits-of-space hard-left">Much easier to create a new application with offline functionality than it is to add it later</p>
          <p class="bits-of-space hard-left">Similar idea to &#8220;Mobile&dash;First&#8221; apps</p>
        </section>
        <section>
          <h2 class="hard-left">Getting Started</h2>
          <ol class="bits-of-space">
            <li class="fragment">Identify basic resources needed to run offline</li>
            <li class="fragment">Pick strategy to cache resources (if needed)</li>
            <li class="fragment">Pick strategy to detect network state</li>
            <li class="fragment">For each feature, pick strategy for handling network state changes</li>
          </ol>
        </section>
        <section>
          <h2 class="hard-left">Identifying Base Resources</h2>
          <p class="hard-left bits-of-space">The resources needed to run the application.</p>
          <ul>
            <li class="fragment">Static files (html, js, css, images)</li>
            <li class="fragment">Configuration / reference data from service</li>
            <li class="fragment">Other mostly&dash;static data (l10n messages)</li>
          </ul>
          <p class="hard-left bits-of-space fragment">Depending on app distribution method, some of these might not need to be cached</p>
        </section>
        <section>
          <h2 class="hard-left">Base Resource Caching</h2>
          <h4 class="hard-left">Strategy 1 &dash; App Cache Manifest</h4>
          <p class="hard-left bits-of-space">A manifest of static resources that a browser should cache so that they can be used if the application is loaded offline</p>
          <p class="hard-left bits-of-space"><b>DEPRECATED</b>... But can sometimes be the only option</p>
        </section>
        <section>
          <h2 class="hard-left">Base Resource Caching</h2>
          <h4 class="hard-left">Strategy 1 &dash; App Cache Manifest &dash; Example:</h4>
          <pre><code data-trim data-noescape class="html">
            &lt;html manifest="example.appcache">
              ...
            &lt;/html>
          </code></pre>
          <pre><code data-trim class="ini">
            CACHE MANIFEST
            # v1 d131dd02c5e6eec4
            # This is another comment
            index.html
            cache.html
            style.css
            image1.png

            # Use from network if available
            NETWORK:
            network.html

            # Fallback content
            FALLBACK:
            / fallback.html
          </code></pre>
        </section>
        <section>
          <h2 class="hard-left">Base Resource Caching</h2>
          <h4 class="hard-left">Strategy 1 &dash; App Cache Manifest</h4>
          <h4 class="hard-left bits-of-space">Pros</h4>
          <ul class="indent-left">
            <li>Works on stubborn browsers (IE, Safari)</li>
            <li>Conceptually easy for static&dash;like resources</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Resource Caching</h2>
          <h4 class="hard-left">Strategy 1 &dash; App Cache Manifest</h4>
          <h4 class="hard-left bits-of-space">Cons</h4>
          <ul class="indent-left">
            <li><b>DEPRECATED!</b></li>
            <li>Implementation is cumbersome</li>
            <li>Will still likely need another solution for more complicated resources</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Resource Caching</h2>
          <h4 class="hard-left">Strategy 2 &dash; Service Workers</h4>
          <p class="hard-left bits-of-space">A JavaScript API that has access to browser cache and can intercept network calls</p>
          <p class="hard-left bits-of-space">Need to fill this section out a lot more...</p>
        </section>
        <section>
          <h2 class="hard-left">Base Resource Caching</h2>
          <h4 class="hard-left">Recommendation</h4>
          <ul class="indent-left">
            <li>Use ServiceWorker when available</li>
            <li>Only use App Cache when no other option</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Detecting Network State</h2>
          <p class="hard-left bits-of-space">When is &#8220;Offline&#8221; really &#8220;Offline&#8221;?</p>
          <ul class="indent-left">
            <li class="fragment">When the device has an IP address?</li>
            <li class="fragment">When the device can reach some arbitrary web site?</li>
            <li class="fragment">When the application can reach its server?</li>
          </ul>
          <p class="hard-left bits-of-space fragment">It doesn't matter if you can reach <a href="https://duckduckgo.com">Duck Duck Go</a>, if you can't reach your server</p>
        </section>
        <section>
          <h2 class="hard-left">Detecting Network State</h2>
          <h4 class="hard-left">Strategy 1 &dash; <code class="hljs">Navigator.onLine</code></h4>
          <p class="hard-left">JavaScript Navigator method to check the online status of the browser</p>
          <ul class="indent-left">
            <li>Different browsers check different things</li>
            <li>&#8220;Offline&#8221; status is probably correct</li>
            <li>&#8220;Online&#8221; status <b>CANNOT</b> be trusted</li>
            <li><code class="hljs">window.on[on|off]line</code> events</li>
            <li><b>Do not</b> use <b>only</b> use this method</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Detecting Network State</h2>
          <h4 class="hard-left">Strategy 2 &dash; Proactive polling</h4>
          <p class="hard-left">Poll the server for a small static resource</p>
          <ul class="indent-left">
            <li>Server-side cache headers are important</li>
            <li>Puts extra load on server / network if already online</li>
            <li>Only use if you have no know network state changes immediately</li>
            <li>Most useful when already offline and detecting when server is avaiable again</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Detecting Network State</h2>
          <h4 class="hard-left">Strategy 3 &dash; Reactive watching server requests</h4>
          <p class="hard-left">Watch requests to the server waiting for a response with no status</p>
          <ul class="indent-left">
            <li>Dispatch custom event when status changes</li>
            <li>Using ServiceWorkers? - Send status change via <code class="hljs">onmessage</code> event</li>
            <li>If not? Use global handler in XHR or other library</li>
            <li>Optionally, start polling once offline</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Detecting Network State</h2>
          <h4 class="hard-left">Recommendation</h4>
          <ul class="indent-left">
            <li>Act like application is online until it isn't</li>
            <li>Only use polling when detecting state change from offline to online</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Dealing With Offline State</h2>
          <h4 class="hard-left">Strategy 1 &dash; Show a message</h4>
          <ul class="indent-left">
            <li>Tell user that connection has been lost</li>
            <li>Optionally show timer when connection will be attempted again</li>
            <li>Optionally allow user to continue to use feature queueing up server operations until connection is restored</li>
            <li>Bare minimum that should be done</li>
            <li>Very popular option: Gmail, Slack, ...</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Dealing With Offline State</h2>
          <h4 class="hard-left">Strategy 2 &dash; Completely remove feature access</h4>
          <ul class="indent-left">
            <li>
              <p>There is no way to put the operation off and a server is absolutely required</p>
              <ul>
                <li>e.g. User password change</li>
              </ul>
            </li>
            <li>Can get complicated.  What do you do if the user is already using the feature?</li>
            <li>Bad UX.  Jarring to have app functionality change in a middle state</li>
            <li>Usually associated with active polling detection strategy</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Dealing With Offline State</h2>
          <h4 class="hard-left">Strategy 3 &dash; No change needed</h4>
          <ul class="indent-left">
            <li>
              <p>Not incredibly useful unless server resources aren't required</p>
              <ul>
                <li>App already has all data it needs</li>
                <li>Operations are expected to queue and timeliness isn't a requirement</li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Dealing With Offline State</h2>
          <h4 class="hard-left">Recommendation</h4>
          <ul class="indent-left">
            <li>Alert user when unable to connect to server</li>
            <li>Only remove features that absolutely require a server</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Caching Strategies</h2>
          <p class="bits-of-space hard-left">Different data may require different strategies</p>
          <ul class="indent-left">
            <li class="fragment">Server Never</li>
            <li class="fragment">Server Only</li>
            <li class="fragment">Storage before Server</li>
            <li class="fragment">Server before Storage</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Caching Strategies</h2>
          <h4 class="hard-left bits-of-space">Server Never</h4>
          <ul class="indent-left">
            <li>No server needed, no need to cache server data</li>
          </ul>
          <h4 class="hard-left bits-of-space">Server Only</h4>
          <ul class="indent-left">
            <li>Data not useful if not current</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Caching Strategies</h2>
          <h4 class="hard-left bits-of-space">Storage before Server &dash; Reads</h4>
          <ul class="indent-left">
            <li>Return the <b>previous</b> payload immediately</li>
            <li>Call server to &#8220;freshen&#8221; data once complete</li>
            <li>Fast!</li>
            <li>Data not always most up&dash;to&dash;date</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Caching Strategies</h2>
          <h4 class="hard-left bits-of-space">Storage before Server &dash; Writes</h4>
          <ul class="indent-left">
            <li>Write transactions immediately to a queue in storage</li>
            <li>When online, write queue to server immediately</li>
            <li>When offline, wait for connection before sending</li>
            <li>Very tolerant of network connectivity issues</li>
            <li>Queued data is at risk of loss</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Caching Strategies</h2>
          <h4 class="hard-left bits-of-space">Server before Storage &dash; Reads &amp; Writes</h4>
          <ul class="indent-left">
            <li>When online, always interact directly with server</li>
            <li>When offline, fallback to cache similar to &#8220;Storage before Server&#8221;</li>
            <li>Can be slow if network status isn't known</li>
            <li>Data more timely</li>
            <li>Write queues not meant to get large</li>
          </ul>
        </section>
        <section>
          <h2 class="hard-left">Base Caching Strategies</h2>
          <h4 class="hard-left">Recommendation</h4>
          <ul class="indent-left">
            <li>Prefer Storage before Server</li>
            <li>Limit the size of write queues</li>
          </ul>
          <p class="hard-left bits-of-space">These were just basic starting strategies. Portions can/should be mixed and matched for best UX</p>
        </section>
        <section>
          <h2 class="hard-left">Other Considerations</h2>
          <ul class="indent-left bits-of-space">
            <li>Cache Storage Limits</li>
            <li>User clearing cache</li>
            <li>User Auth</li>
            <li>Evolving cache data structure</li>
          </ul>
        </section>
        <section>
          <h2>Demo?</h2>
        </section>
        <section>
          <h2>Questions?</h2>
        </section>
        <section>
          <h1 class="lots-of-space">Thanks!</h1>
          <p class="bits-of-space">Jason Schindler</p>
          <p><a href="mailto:schindlerj@objectcomputing.com">schindlerj@objectcomputing.com</a></p>
          <p><a href="http://jason.types.codes">jason.types.codes</a></p>
        </section>
      </div>
    </div>
    <script type="text/javascript" src="presentation.js" charset="utf-8"></script>
  </body>
</html>